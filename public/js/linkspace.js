!function(){"use strict";Array.prototype.filter||(Array.prototype.filter=function(e){if(null==this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var a,i=[],o=arguments[1],r=0;r<n;r++)r in t&&(a=t[r],e.call(o,a,r,t)&&i.push(a));return i}),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var a=arguments[1],i=0;i<n;){var o=t[i];if(e.call(a,o,i,t))return o;i++}return undefined}),"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e.apply(this,[this[t],t,this])}),Array.prototype.includes||(Array.prototype.includes=function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0==a)return!1;for(var t=0|t,i=Math.max(0<=t?t:a-Math.abs(t),0),o=function o(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)};i<a;){if(o(n[i],e))return!0;i++}return!1}),Array.prototype.map||(Array.prototype.map=function(e){if(null==this)throw TypeError();var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw TypeError();var a=[];a.length=n;for(var i=arguments[1],o=0;o<n;o++)o in t&&(a[o]=e.call(i,t[o],o,t));return a}),Array.prototype.some||(Array.prototype.some=function(e,t){if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var n=Object(this),a=n.length>>>0,i=0;i<a;i++)if(i in n&&e.call(t,n[i],i,n))return!0;return!1}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function a(){},i=function i(){return n.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,i.prototype=new a,i}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw TypeError("Object.keys called on non-object");var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n});var t=$.fn.datepicker;$.fn.datepicker=function(){var e=t.apply(this,arguments);return this.on("show",function(){var e=$(this),t=e.data("datepicker").picker,e=t.hasClass("datepicker-orient-top")?e.offset().top-t.outerHeight()-parseInt(t.css("marginTop")):e.offset().top+e.outerHeight()+parseInt(t.css("marginTop"));t.offset({top:e})}),e};var a,n=(a=function a(e){$("a[role=button]",e).on("keypress",function(e){32===e.keyCode&&this.click()});var n=$(".navbar-fixed-bottom",e);n.length&&$(".edit-form .form-group",e).on("focusin",function(e){var t=$(e.target),e=t.offset().top+t.outerHeight(),t=n.offset().top;t<e&&$("html, body").animate({scrollTop:$(window).scrollTop()+e-t+20},300)})},function(e){a(e)});function o(t,e){var n,a=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)),a}function i(a){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){var t,n;t=a,e=i[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(i,e))})}return a}var r,l,c,s,d,u,f,p,h,m,v,g,b,y,A,x,w,k,T,j,C,O,S,D,L,q,R,E,P,F,N,I,B,J,M,H,z,W,G,U,V,Y,X,Q,Z,K,ee,te,ne,ae,ie,oe,re,le,ce,se,de,ue,fe,pe,he,me=(r=function r(e){if(!["date","daterange"].includes(e))return undefined;var t=["equal","not_equal","less","less_or_equal","greater","greater_or_equal","is_empty","is_not_empty"];return"daterange"===e&&t.push("contain"),t},l=function l(a,i,o,r){return{input:function(e,t,n){return'<input class="typeahead_text" type="text" name="'.concat(n,'_text">\n      <input class="typeahead_hidden" type="hidden" name="').concat(n,'"></input>')},valueSetter:function(e,t,n,a,i){e.find(".typeahead_text").val(i.text),e.find(".typeahead_hidden").val(t)},onAfterCreateRuleInput:function(e){var t=$("#".concat(e.attr("id"),' .rule-value-container input[type="text"]')),n=$("#".concat(e.attr("id"),' .rule-value-container input[type="hidden"]'));t.attr("autocomplete","off"),t.typeahead({delay:100,matcher:function(){return!0},sorter:function(e){return e},displayText:function(e){return e.label},afterSelect:function(e){r?n.val(e.id):n.val(e.label)},source:function(e,t){return $.ajax({type:"GET",url:"/".concat(i,"/match/layout/").concat(a),data:{q:e,oi:o},success:function(e){t(e.records)},dataType:"json"})}})}}},u=[{type:"equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater",accept_values:!0,apply_to:["string","number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"contains",accept_values:!0,apply_to:["datetime","string"]},{type:"not_contains",accept_values:!0,apply_to:["datetime","string"]},{type:"begins_with",accept_values:!0,apply_to:["string"]},{type:"not_begins_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!(d=function d(){window.UpdateFilter=function(e){e=e.queryBuilder("getRules");$("#filter").val(JSON.stringify(e,null,2))}}),apply_to:["string","number","datetime"]},{type:"is_not_empty",accept_values:!(s=function s(e,t){return i({id:t.filterId,label:t.label,type:"string",operators:r(t.type)},"rag"===t.type?c:t.hasFilterTypeahead?l(t.urlSuffix,e.layoutId,t.instanceId,t.useIdInFilter):{})}),apply_to:["string","number","datetime"]},{type:"changed_after",nb_inputs:1,accept_values:!0,multiple:!(c={input:"select",values:{b_red:"Red",c_amber:"Amber",c_yellow:"Yellow",d_green:"Green",a_grey:"Grey",e_purple:"Purple"}}),apply_to:["string","number","datetime"]}],f=function f(e){var t=JSON.parse($(e).html());t.filters.length&&(t.filterNotDone&&d(),$("#builder".concat(t.builderId)).queryBuilder({showPreviousValues:t.showPreviousValues,filters:t.filters.map(function(e){return s(t,e)}),operators:u,lang:{operators:{changed_after:"changed on or after"}}}))},p=function p(e){$('script[id^="builder_json_"]',e).each(function(e,t){f(t)})},h=function h(e){$(document,e).on("input",".typeahead_text",function(){var e=$(this).val();$(this).next(".typeahead_hidden").val(e)})},function(e){p(e),h(e)}),ve=function ve(){window.FontDetect&&(FontDetect.isFontLoaded("14px/1 FontAwesome")||($(".use-icon-font").hide(),$(".use-icon-png").show()))},ge=(m=function m(e){var t=$("#calendar",e);if(!t.length)return!1;var n={events_source:"/".concat(t.attr("data-event-source"),"/data_calendar/").concat((new Date).getTime()),view:t.data("view"),tmpl_path:"/tmpls/",tmpl_cache:!1,onAfterEventsLoad:function(e){var n;e&&((n=$("#eventlist")).html(""),$.each(e,function(e,t){$(document.createElement("li")).html('<a href="'.concat(t.url,'">').concat(t.title,"</a>")).appendTo(n)}))},onAfterViewLoad:function(e){$("#caltitle").text(this.getTitle()),$(".btn-group button").removeClass("active"),$('button[data-calendar-view="'.concat(e,'"]')).addClass("active")},classes:{months:{general:"label"}}},e=t.data("calendar-day-ymd");return e&&(n.day=e),t.calendar(n)},v=function v(t,e){$(".btn-group button[data-calendar-nav]",e).each(function(){var e=$(this);e.click(function(){t.navigate(e.data("calendar-nav"))})}),$(".btn-group button[data-calendar-view]",e).each(function(){var e=$(this);e.click(function(){t.view(e.data("calendar-view"))})})},g=function g(t,e){$("#first_day",e).change(function(){var e=(e=$(this).val()).length?parseInt(e):null;t.setOptions({first_day:e}),t.view()}),$("#language",e).change(function(){t.setLanguage($(this).val()),t.view()}),$("#events-in-modal",e).change(function(){var e=$(this).is(":checked")?$(this).val():null;t.setOptions({modal:e})}),$("#events-modal .modal-header, #events-modal .modal-footer",e).click(function(){})},function(e){var t=m(e);t&&(v(t,e),g(t,e),ve())}),$e=(b=function b(t){return t=t||{},_.chain(location.search.slice(1).split("&")).map(function(e){return e?e.split("="):undefined}).compact().value().filter(function(e){return e[0]!==t.except})},y=function y(e){$(".column-filter",e).each(function(){var e=$(this),n=e.data("col-id"),t=e.data("autocomplete-endpoint"),a=e.data("autocomplete-has-id"),i=e.data("values")||[],o=e.find(".column-filter__error"),r=e.find(".column-filter__search-input"),l=e.find(".column-filter__clear-search-input"),c=e.find(".column-filter__spinner"),s=e.find(".column-filter__values"),d=e.find(".column-filter__submit"),u=function u(){return r.length?r.val():""},f=function f(){return 1===r.length},p=function p(e,t){t="column_filter_value_label_"+n+"_"+t;return $('<li class="column-filter__value"><label id="'+t+'_label" for="'+t+'"><input id="'+t+'" type="checkbox" value="'+e.id+'" '+(e.checked?"checked":"")+' aria-labelledby="'+t+'_label"><span role="option">'+e.value+"</span></label></li>")},h=function h(){var t=u();s.empty();var e=_.filter(i,function(e){return-1<e.value.toLowerCase().indexOf(t.toLowerCase())}),e=f()?_.sortBy(e,"value"):e;_.each(e,function(e,t){s.append(p(e,t))})},m=function m(){o.attr("hidden",""),h()},e=_.debounce(function(){var e=u();e.length?(o.attr("hidden",""),c.removeAttr("hidden"),$.getJSON(t+e,function(e){_.each(e.records,function(t){a?_.some(i,function(e){return e.id===t.id.toString()})||i.push({id:t.id.toString(),value:t.label}):i.push({value:t})})}).fail(function(e,t,n){o.text(n),o.removeAttr("hidden")}).always(function(){c.attr("hidden",""),h()})):m()},250);s.delegate("input","change",function(){var t=$(this).val(),e=_.findIndex(i,function(e){return e.id===t});i[e].checked=this.checked}),r.on("keyup",function(){$(this).val().length?l.removeAttr("hidden"):l.attr("hidden","")});var v=function v(e){return"undefined"==typeof e[1]?e[0]:e[0]+"="+e[1]};a?(r.on("keyup",e),d.on("click",function(){var e=_.map(_.filter(i,"checked"),"id"),t=b({except:"field"+n});e.forEach(function(e){t.push(["field"+n,e])}),window.location="?"+t.map(function(e){return v(e)}).join("&")})):(r.on("keypress",function(e){13===e.keyCode&&(e.preventDefault(),d.trigger("click"))}),d.on("click",function(){var e=b({except:"field"+n});e.push(["field"+n,u()]),window.location="?"+e.map(function(e){return v(e)}).join("&")})),l.on("click",function(e){e.preventDefault(),r.val(""),l.attr("hidden",""),m()}),h()})},function(e){y(e)}),be=function be(e,t,n){var a=t+"px",n=e+n+"px";this.css({left:a,top:n}),document.body&&document.body.clientWidth&&this.get(0).getBoundingClientRect&&((n=document.body.clientWidth-this.get(0).getBoundingClientRect().right)<0&&this.css({left:t+n+"px"}))},ye=function ye(e,t,n,a){t.attr("aria-expanded",n),t.toggleClass("expanded--permanent",n&&a);var i=t.data("label-expanded"),o=t.data("label-collapsed");o&&i&&t.html(n?i:o);var r=t.siblings(".expandable").first();r.toggleClass("expanded",n),r.hasClass("popover")&&(i=(a=t.offset()).top,o=a.left,(a=t.offsetParent())&&(i-=(a=a.offset()).top,o-=a.left),be.call(r,i,o,t.outerHeight()+6)),t.trigger(n?"expand":"collapse",r),e.stopPropagation()},_e=function _e(e){var t=$(this),n=t.hasClass("expanded--permanent");ye(e,t,!n,!0)},xe=function xe(e){var t=$(this);"true"===t.attr("aria-expanded")||ye(e,t,!0,!1)},we=function we(e){var t=$(this),n="true"===t.attr("aria-expanded"),a=t.hasClass("expanded--permanent");n&&!a&&ye(e,t,!1,!1)},ke=function ke(e){$(".trigger[aria-expanded]",e).on("click",_e),$(".trigger[aria-expanded][data-expand-on-hover=true]",e).on("mouseover",xe),$(".trigger[aria-expanded][data-expand-on-hover=true]",e).on("mouseout",we)},Te=(A=function A(l){var c=this,a=this.find(".form-control"),i=a.find("[aria-expanded]"),s=this.find(".current"),d=this.find(".available"),u=this.find(".available .answer input"),f=this.find(".available .answer .more-info"),o=this.find("#"+i.attr("aria-controls")),p=s.find("[data-list-item]"),h=this.find(".answer"),r=null,m=this.find(".form-control-search"),v=null,g=function g(e,t,n){c.removeClass("select-widget--open"),t.attr("aria-expanded",!1),setTimeout(function(){m.val(""),n.attr("hidden",""),h.removeAttr("hidden")},50)},b=function b(e){var t=s.children("[data-list-item]:not([hidden])");s.toggleClass("empty",0===t.length),e||a.trigger("change")},y=function y(e){e=e.relatedTarget||document.activeElement;c.find(e).length||!e||$(e).is(".modal, .page")||c.get(0).parentNode===e||g(a,i,o)},e=function e(n){return function(){var t=$(this),e=t.data("list-item"),i=$("#"+e);i.unbind("change"),i.on("change",function(e){e.stopPropagation(),$(this).prop("checked")?t.removeAttr("hidden"):t.attr("hidden",""),n()}),i.unbind("keydown"),i.on("keydown",function(e){var t=e.which||e.keyCode;switch(t){case 38:case 40:var n=d.find(".answer:not([hidden])"),a=n.index(i.closest(".answer"));e.preventDefault(),(a=38===t?n[a-1]:n[a+1])&&$(a).find("input").focus();break;case 13:e.preventDefault(),$(this).trigger("click")}})}},t=function t(){p.each(function(e,t){var n=$(t),t=n.data("list-item"),t=$("#"+t);t.unbind("click"),t.on("click",function(e){e.stopPropagation()}),t.parent().unbind("keypress"),t.parent().on("keypress",function(e){13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),$(this).trigger("click"))}),t.parent().unbind("click"),t.parent().on("click",function(e){e.stopPropagation(),p.each(function(){$(this).attr("hidden","")}),s.toggleClass("empty",!1),n.removeAttr("hidden"),g(a,i,o)})})},_=function _(){l?p.each(e(b)):t()},x=function x(e,t,n,a,i,o){if(e&&!n)return $('<li class="none-selected">blank</li>');e=$("<li "+(i?"":"hidden")+' data-list-item="'+(n?t+"_"+n:t+"__blank")+'" class="'+(n?"":"current__blank")+'"><span class="widget-value__value"></span>'+(e?'<button type="button" class="close select-widget-value__delete" aria-hidden="true" aria-label="delete" title="delete" tabindex="-1">&times;</button>':"")+"</li>");return e.data("list-text",a),e.find("span").html(o),e},w=function w(e,t,n,a,i,o){if(e&&!n)return null;var r=n?t+"_"+n:t+"__blank",l=n?"answer":"answer answer--blank",c=' <span class="details"><button type="button" class="more-info" data-record-id="'+n+'" aria-describedby="'+r+'_label" aria-haspopup="listbox">Details</button></span>',s=$('<span role="option"></span>');s.data("list-text",a),s.data("list-id",n),s.html(o);c=$('<li class="'+l+'"><span class="control"><label id="'+r+'_label" for="'+r+'"><input id="'+r+'" type="'+(e?"checkbox":"radio")+'" name="'+t+'" '+(i?"checked":"")+' value="'+(n||"")+'" class="'+(e?"":"visually-hidden")+'" aria-labelledby="'+r+'_label"> </label></span>'+(n?c:"")+"</li>");return c.find("label").append(s),c},k=0,T=function T(e,a){var n=++k;d.find(".spinner").removeAttr("hidden");var i=d.find("input:checked").map(function(){return parseInt($(this).val())}).get();a||d.find(".answer").remove();var o=c.data("field"),r=!0;$.getJSON(e,function(e){var t;0===e.error?n==k?((a?p.filter(":hidden"):p).remove(),t=i.includes(NaN),l&&(m.parent().prevAll(".none-selected").remove(),m.parent().before(x(l,o,null,"blank",t)),d.append(w(l,o,null,"blank",t))),$.each(e.records,function(e,t){var n=i.includes(t.id);a&&(!a||n)||(m.parent().before(x(l,o,t.id,t.label,n,t.html)).before(" "),d.append(w(l,o,t.id,t.label,n,t.html)))}),p=s.find("[data-list-item]"),d=c.find(".available"),u=c.find(".available .answer input"),f=c.find(".available .answer .more-info"),h=c.find(".answer"),b(),_(),u.on("blur",y),f.on("blur",y)):r=!1:(e=1===e.error?e.message:"Oops! Something went wrong.",e=$('<li class="answer answer--blank alert alert-danger"><span class="control"><label>'+e+"</label></span></li>"),d.append(e))}).fail(function(e,t,n){Linkspace.error("Failed to make request to "+filterEndpoint+": "+t+": "+n);n=$('<li class="answer answer--blank alert alert-danger"><span class="control"><label>Oops! Something went wrong.</label></span></li>');d.append(n)}).always(function(){r&&d.find(".spinner").attr("hidden","")})},j=function j(){c.data("field"),c.hasClass("multi");var e=c.data("filter-endpoint"),t=c.data("filter-fields"),n=c.data("submission-token");$.isArray(t)||Linkspace.error("Invalid data-filter-fields found. It should be a proper JSON array of fields.");var i=["submission-token="+n];$.each(t,function(e,a){$("input[name="+a+"]").each(function(e,t){var n=$(t);switch(n.attr("type")){case"text":i.push(a+"="+n.val());break;case"radio":case"checkbox":t.checked&&i.push(a+"="+n.val());break;case"hidden":i.push(a+"="+n.val())}})});t=i.join("&");v!==t&&(v=null,T(e+"?"+t),v=t)},C=function C(e,t,n){var a,i;"true"!==t.attr("aria-expanded")&&(c.addClass("select-widget--open"),t.attr("aria-expanded",!0),c.data("filter-endpoint")&&c.data("filter-endpoint").length&&j(),i=(a=e.offset().top)+e.outerHeight(),e=(t=$(window).scrollTop())+$(window).height()-60,e=t<a-200&&!(i+200<e),n.toggleClass("available--top",e),n.removeAttr("hidden"),m.get(0)!==document.activeElement&&m.focus())};b(!0),_(),a.unbind("click"),a.on("click",function(){("true"===i.attr("aria-expanded")?g:C)(a,i,o)}),m.unbind("blur"),m.on("blur",y),u.unbind("blur"),u.on("blur",y),f.unbind("blur"),f.on("blur",y),$(document).on("click",function(e){var t=!this.is(e.target)&&0===this.has(e.target).length,e=0!==$(e.target).closest(".modal").length;t&&!e&&g(a,i,o)}.bind(this)),$(document).keyup(function(e){27==e.keyCode&&g(a,i,o)});var O,n=function n(e){e.stopPropagation(),C(a,i,o)};a.delegate(".select-widget-value__delete","click",function(e){e.preventDefault(),e.stopPropagation();e=e.target.parentElement.getAttribute("data-list-item"),e=document.querySelector("#"+e);e.checked=!1,$(e).trigger("change")}),m.unbind("focus",n),m.on("focus",n),m.unbind("keydown"),m.on("keydown",function(e){var t=e.which||e.keyCode;switch(t){case 38:case 40:var n=d.find(".answer:not([hidden]) input");e.preventDefault(),(n=38===t?n[n.length-1]:n[0])&&$(n).focus();break;case 13:e.preventDefault();n=d.find(".answer:not([hidden]) input").get(0);n&&$(n).parent().trigger("click")}}),m.unbind("keyup"),m.on("keyup",function(){var e,t,n=$(this).val().toLowerCase();(r=r||$("<span>").addClass("form-control-search").css("white-space","nowrap")).text(n),m.css("width",r.insertAfter(m).width()+70),r.detach(),"typeahead"==c.data("value-selector")?(e="/".concat(c.data("layout-id"),"/match/layout/").concat(c.data("typeahead-id")),clearTimeout(O),d.find(".spinner").removeAttr("hidden"),O=setTimeout(function(){d.find(".answer").not(".answer--blank").each(function(){var e=$(this);e.find("input:checked").length||e.remove()}),T(e+"?noempty=1&q="+n,!0)},200)):(t=!1,$.each(h,function(){-1===$(this).find("label")[0].innerHTML.toLowerCase().indexOf(n)?$(this).attr("hidden",""):(t=!0,$(this).removeAttr("hidden",""))}),t?d.find(".has-noresults").attr("hidden",""):d.find(".has-noresults").removeAttr("hidden",""))}),m.unbind("click"),m.on("click",function(e){e.stopPropagation()})},x=function x(e){$(".select-widget",e).each(function(){var e=$(this).hasClass("multi");A.call($(this),e)})},function(e){x(e)}),je=function je(e){return e?{year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:0,minute:0,second:0,epoch:e.getTime()/1e3}:undefined},Ce=function Ce(e,t,n){var a=e.data("column-type");if((0==e.length||"none"==e.css("display"))&&"calc"!=a)return[""];var i=[];if("enum"===a||"curval"===a){if(t?e.find(".select-widget .available .answer").each(function(){var e=$(this).find('[role="option"]');i.push(e)}):e.find(".select-widget .current [data-list-item]:not([hidden])").each(function(){var e=$(this).hasClass("current__blank")?undefined:$(this);i.push(e)}),n){if(e.data("is-multivalue")){var o=$.map(i,function(e){return{id:e.data("list-id"),value:e.data("list-text")}});return{text:$.map(o,function(e){return e.value}).join(", "),values:o}}return i.length&&i[0]?i[0].data("list-text"):undefined}i=$.map(i,function(e){return e?e.data("list-text"):""})}else if("person"===a)i=[e.find("option:selected").text()];else if("tree"===a)e.find(".selected-tree-value").each(function(){i.push($(this).data("text-value"))});else if("daterange"===a){o=e.find(".form-control");var r,l=[];if(o.each(function(e){e%2==0?r=$(this):l.push({from:r,to:$(this)})}),n){o=l.map(function(e){var t=e.from.datepicker("getDate"),n=e.to.datepicker("getDate");return t&&n?{from:je(t),to:je(n),value:e.from.val()+" to "+e.to.val()}:undefined});return e.data("is-multivalue")?o:o[0]}i=l.map(function(e){return e.from.val()+" to "+e.to.val()})}else if("date"===a)if(e.data("is-multivalue")){if(i=e.find(".form-control").map(function(){var e=$(this);return n?je(e.datepicker("getDate")):e.val()}).get(),n)return i}else{a=e.find(".form-control");if(n)return je(a.datepicker("getDate"));i=[a.val()]}else i=[],e.find(".form-control").each(function(){var e=$(this);i.push(e.val().length?e.val():undefined)}),n&&!e.data("is-multivalue")&&(i=i.shift());return Array.isArray(i)&&0==i.length&&(i=[""]),i},Oe=function Oe(){var e=function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Ae=(w=function w(n,a,i){var o,e,t,r=n.serialize(),l=n.data("modal-field-ids"),c=n.data("curval-id"),s=n.data("instance-name"),d=n.data("guid"),u=$("<input>",i).attr({type:"hidden",name:"field"+c,value:r}),f=$("div[data-column-id="+c+"]",i);"noshow"===f.data("value-selector")?(o=$('<tr class="curval_item">',i),jQuery.map(l,function(e){var t=n.find('[data-column-id="'+e+'"]'),t=Ce(t),t=a["field"+e];t=$("<div />",i).text(t).html(),o.append($('<td class="curval-inner-text">',i).append(t))}),t=$('<td>\n        <a class="curval-modal" style="cursor:pointer" data-layout-id="'.concat(c,'" data-instance-name=').concat(s,'>edit</a> | <a class="curval_remove" style="cursor:pointer">remove</a>\n      </td>'),i),o.append(t.append(u)),d?$('input[data-guid="'+d+'"]',i).val(r).closest(".curval_item").replaceWith(o):$("#curval_list_".concat(c),i).find("tbody").prepend(o)):(e=f.find(".select-widget").first().hasClass("multi"),s=f.find(".current [data-list-item]"),t=f.find(".current .search"),u=f.find(".available"),e||(s.attr("hidden",""),u.find("li input").prop("checked",!1)),s=jQuery.map(l,function(e){e=a["field"+e];return $("<div />").text(e).html()}).join(", "),d=Oe(),l="field".concat(c,"_").concat(d),d=e?'<button class="close select-widget-value__delete" aria-hidden="true" aria-label="delete" title="delete" tabindex="-1">&times;</button>':"",t.before('<li data-list-item="'.concat(l,'">').concat(s).concat(d,"</li>")).before(" "),d=e?"checkbox":"radio",u.append('<li class="answer">\n        <span class="control">\n            <label id="'.concat(l,'_label" for="').concat(l,'">\n                <input id="').concat(l,'" name="field').concat(c,'" type="').concat(d,'" value="').concat(r,'" class="').concat(e?"":"visually-hidden",'" checked aria-labelledby="').concat(l,'_label">\n                <span>').concat(s,'</span>\n            </label>\n        </span>\n        <span class="details">\n            <a class="curval_remove" style="cursor:pointer">remove</a>\n        </span>\n      </li>')),Te(f)),$(".modal.in",i).modal("hide")},k=function k(e,t){e.find(".alert").text(t).removeAttr("hidden"),e.parents(".modal-content").get(0).scrollIntoView(),e.find("button[type=submit]").prop("disabled",!1)},T=function T(c){$(document,c).on("mousedown",".curval-modal",function(e){var t,n=$(e.target).data("layout-id"),a=$(e.target).data("instance-name"),i=$(e.target).data("current-id"),o=$(e.target).closest(".curval_item").find("input[name=field".concat(n,"]")),e=o.val(),r=o.length?"edit":"add";"edit"==r&&((t=o.data("guid"))||(t=Oe(),o.attr("data-guid",t)));var l=$("#curval_modal",c);l.find(".modal-body").text("Loading...");a=i?"/record/".concat(i):"/".concat(a,"/record/");l.find(".modal-body").load("".concat(a,"?include_draft&modal=").concat(n,"&").concat(e),function(){"edit"==r&&l.find("form").data("guid",t),Linkspace.init(l)}),l.on("focus",".datepicker",function(){$(this).datepicker({format:l.attr("data-dateformat-datepicker"),autoclose:!0})}),l.modal()})},j=function j(e){$("#curval_modal",e).on("submit",".curval-edit-form",function(e){e.preventDefault();var a=$(this),e=a.serialize();a.addClass("edit-form--validating"),a.find(".alert").attr("hidden",""),$.post(a.attr("action")+"?validate&include_draft",e,function(e){0===e.error?w(a,e.values):(e=1===e.error?e.message:"Oops! Something went wrong.",k(a,e))},"json").fail(function(e,t,n){n="Oops! Something went wrong: ".concat(t,": ").concat(n);k(a,n)}).always(function(){a.removeClass("edit-form--validating")})})},C=function C(t){$(".curval_group",t).on("click",".curval_remove",function(){confirm("Are you sure want to permanently remove this item?")?$(this).closest(".curval_item").remove():e.preventDefault()}),$(".select-widget",t).on("click",".curval_remove",function(){var e=$(this).closest(".answer").find("input").prop("id");$(this).closest(".select-widget").find(".current li[data-list-item=".concat(e,"]")).remove(),$(this).closest(".answer").remove()})},function(e){T(e),j(e),C(e)}),Se=(O=function O(e){$(".datepicker",e).datepicker({format:$(document.body).data("config-dataformat-datepicker"),autoclose:!0})},S=function S(e){$(".input-daterange input.from",e).each(function(){$(this).on("changeDate",function(){var e=$(this).parents(".input-daterange").find(".datepicker.to");e.val()||e.datepicker("update",$(this).datepicker("getDate"))})})},D=function D(e){$(document,e).on("click",".remove_datepicker",function(){var e=".datepicker"+$(this).data("field");$(e).datepicker("destroy"),alert("Date selector has been disabled for this field")})},function(e){O(e),S(e),D(e)}),De=(L=function L(e){$(document,e).on("click",".cloneme",function(){var e=$(this).parents(".input_holder"),t=e.clone();t.removeAttr("id").insertAfter(e),t.find(":text").val(""),t.find(".datepicker").datepicker({format:e.attr("data-dateformat-datepicker"),autoclose:!0})}),$(document,e).on("click",".removeme",function(){var e=$(this).parents(".input_holder");0<e.siblings(".input_holder").length&&e.remove()})},q=function q(a){$("#helptext_modal",a).on("show.bs.modal",function(e){var e=$(e.relatedTarget).data("load-url"),t=$(this),n=t.find(".modal-body").html("");$.ajax(e,{timeout:5e3,success:function(e){n.html(e)},error:function(){alert("Failed to load help text"),t.modal("hide")}})}),$("#helptext_modal_close").on("click",function(e){$("#helptext_modal").modal("hide")}),$(document,a).on("click",".more-info",function(t){var e=$(t.target).data("record-id"),n=$("#readmore_modal",a);n.find(".modal-body").text("Loading..."),n.find(".modal-body").load("/record_body/"+e),n.one("show.bs.modal",function(e){e.isDefaultPrevented()||n.one("hidden.bs.modal",function(){$(t.target,a).is(":visible")&&$(t.target,a).trigger("focus")})}),n.one("keyup",function(e){27==e.keyCode&&e.stopPropagation()}),n.modal()})},R=function R(a){$('input[type="text"][id^="typeahead_"]',a).each(function(e,n){$(n,a).change(function(){$(this).val()||$("#".concat(n.id,"_value"),a).val("")}),$(n,a).typeahead({delay:500,matcher:function(){return!0},sorter:function(e){return e},afterSelect:function(e){$("#".concat(n.id,"_value"),a).val(e.id)},source:function(e,t){return $.ajax({type:"GET",url:"/".concat($(n,a).data("layout-id"),"/match/layout/").concat($(n).data("typeahead-id")),data:{q:e},success:function(e){t(e)},dataType:"json"})}})})},function(e){L(e),q(e),Ae(e),Se(e),R(e)}),Le=(E=function E(e){$(".fileupload",e).each(function(){var a=$(this),i=a.find("ul"),e=a.data("fileupload-url"),o=a.data("field"),t=a.find(".progress-bar__container"),n=a.find(".progress-bar__progress"),r=a.find(".progress-bar__percentage");a.fileupload({dataType:"json",url:e,paramName:"file",submit:function(){t.css("display","block"),r.html("0%"),n.css("width","0%"),n.removeClass("progress-bar__fail")},progress:function(e,t){a.data("multivalue")||(t=Math.round(t.loaded/t.total*1e4)/100+"%",r.html(t),n.css("width",t))},progressall:function(e,t){a.data("multivalue")&&(t=Math.round(t.loaded/t.total*1e4)/100+"%",r.html(t),n.css("width",t))},done:function(e,t){a.data("multivalue")||i.empty();var n=t.result.url.split("/").pop(),t=t.files[0].name,t=$('<li class="help-block"><input type="checkbox" name="'+o+'" value="'+n+'" aria-label="'+t+'" checked>Include file. Current file name: <a href="/file/'+n+'">'+t+"</a>.</li>");i.append(t)},fail:function(e,t){t=t.jqXHR.responseJSON;n.css("width","100%"),n.addClass("progress-bar__fail"),t.message?r.html("Error: "+t.message):r.html("An unexpected error occurred")}})})},function(e){E(e)}),qe=(P=function P(e){$(".edit-form *:input[type!=hidden]:first",e).focus()},function(e){P(e)}),Re=(F=function F(e){var t=$("#globe",e);t.length&&(Plotly.setPlotConfig({locale:"en-GB"}),e=JSON.parse(base64.decode(t.attr("data-globe"))),t={showLink:!1,displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"],topojsonURL:"".concat(t.attr("data-url"),"/")},Plotly.newPlot("globe",e,{margin:{t:10,l:10,r:10,b:10},geo:{scope:"world",showcountries:!0,countrycolor:"grey",resolution:110}},t))},function(e){F(e)}),Ee=(N=function N(e){Plotly.setPlotConfig({locale:"en-GB"});var a=JSON.parse(base64.decode(e.data("globe-data"))),t=a.data,n={showLink:!1,displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"],topojsonURL:e.data("topojsonurl")};Plotly.newPlot(e.get(0),t,{margin:{t:10,l:10,r:10,b:10},geo:{scope:"world",showcountries:!0,countrycolor:"grey",resolution:110}},n).then(function(e){e.on("plotly_click",function(e){var t,n;e.event.defaultPrevented||(t=(e.points||[])[0],e=(n=a.params).globe_fields.map(function(e){return e+"="+t.location}).join("&"),e="/"+n.layout_identifier+"/data?viewtype=table&view="+n.view_id+"&"+e,n.default_view_limit_extra_id&&(e=e+"&extra="+n.default_view_limit_extra_id),location.href=e)})})},function(e){N(e)}),Pe=(I=function I(e,t){var n;e.type.includes("image")?((n=new FormData).append("file",e),n.append("csrf_token",$("body").data("csrf-token")),$.ajax({url:"/file?ajax&is_independent",type:"POST",contentType:!1,cache:!1,processData:!1,dataType:"JSON",data:n,success:function(e){e.is_ok?$(t).summernote("editor.insertImage",e.url):Linkspace.debug(e.error)}}).fail(function(e){Linkspace.debug(e)})):Linkspace.debug("The type of file uploaded was not an image")},B=function B(e){$.summernote&&$(".summernote",e).summernote({dialogsInBody:!0,height:400,callbacks:{onInit:function(){var e=$(this).siblings("input[type=hidden].summernote_content");$(this).summernote("code",e.val())},onImageUpload:function(e){for(var t=0;t<e.length;t++)I(e[t],this)},onChange:function(e){var t=$(this).closest(".summernote");t.summernote("isEmpty")&&(e=""),t.siblings("input[type=hidden].summernote_content").val(e)}}})},function(e){B(e)}),Fe=(J=function J(e){e.prevAll(".jstree-expand-all").on("click",function(){e.jstree(!0).open_all()}),e.prevAll(".jstree-collapse-all").on("click",function(){e.jstree(!0).close_all()}),e.prevAll(".jstree-reload").on("click",function(){e.jstree(!0).refresh()})},function(e){J(e)}),Ne=(M=function M(n){var a=function a(){var e=$("#jstree_demo_div",n).jstree(!0),t=e.get_selected();if(!t.length)return!1;e.delete_node(t)};$("#btnDeleteNode",n).click(a);var i=function i(){var e=$("#jstree_demo_div",n).jstree(!0),t=(t=e.get_selected()).length?t[0]:"#";(t=e.create_node(t,{type:"file"}))&&e.edit(t)};$("#btnAddNode",n).click(i);var o=function o(){var e=$("#jstree_demo_div",n).jstree(!0),t=e.get_selected();if(!t.length)return!1;t=t[0],e.edit(t)};$("#btnRenameNode",n).click(o)},H=function H(e){$("#selectall",e).click(function(){7==$(".check_perm:checked",e).length?$(".check_perm",e).prop("checked",!1):$(".check_perm",e).prop("checked",!0)})},z=function z(e){$(".sortable",e).length&&$(".sortable",e).sortable({handle:".drag"})},W=function W(e){var t=$("#jstree_demo_div",e);t.length&&(t.jstree({core:{check_callback:!0,force_text:!0,themes:{stripes:!0},worker:!1,data:{url:function(){return"/".concat(t.data("layout-identifier"),"/tree").concat((new Date).getTime(),"/").concat(t.data("column-id"),"?")},data:function(e){return{id:e.id}}}}}),Fe(t))},G=function G(t){$("div#legs",t).on("click",".add",function(e){$(e.currentTarget,t).closest("#legs").find(".sortable").append('\n          <div class="request-row">\n            <p>\n              <input type="hidden" name="enumval_id">\n              <input type="text" class="form-control" style="width:80%; display:inline" name="enumval">\n              <button type="button" class="close closeme" style="float:none">&times;</button>\n              <span class="fa fa-hand-paper-o fa-lg use-icon-font close drag" style="float:none"></span>\n            </p>\n          </div>\n      '),$(".sortable",t).sortable("refresh")}),$("div#legs").on("click",".closeme",function(e){$(".request-row",t).length<2||$(e.currentTarget,t).parents(".request-row").remove()})},U=function U(t){$("#refers_to_instance_id",t).change(function(e){e="#instance_fields_".concat($(e.currentTarget,t).val());$(".instance_fields",t).hide(),$(e,t).show()})},V=function V(t){$("#related_field_id",t).change(function(e){e=$(e.currentTarget).find(":selected").data("instance_id");$(".autocur_instance",t).hide(),$("#autocur_instance_".concat(e),t).show()}),$("#filval_related_field_id",t).change(function(){var e=$(this).val();$(".filval_curval",t).hide(),$("#filval_curval_"+e,t).show()})},Y=function Y(e){$('div[id^="builder"]',e).each(function(e,t){var n=$(t).data("filter-base");n&&(n=base64.decode(n),$(t).queryBuilder("setRules",JSON.parse(n)))})},X=function X(e){var t,n=$("#displayConditionsBuilder",e);n.length&&(t=n.data(),(e=JSON.parse(base64.decode(t.filters))).length&&(n.queryBuilder({filters:e,allow_groups:0,operators:[{type:"equal",accept_values:!0,apply_to:["string"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"not_equal",accept_values:!0,apply_to:["string"]},{type:"not_contains",accept_values:!0,apply_to:["string"]}]}),t.filterBase&&(t=base64.decode(t.filterBase),n.queryBuilder("setRules",JSON.parse(t)))))},Q=function Q(a){$("#submit_save",a).click(function(){var e=$("#displayConditionsBuilder",a).queryBuilder("getRules");$("#displayConditions",a).val(JSON.stringify(e,null,2));var t="#builder".concat($("#refers_to_instance_id",a).val()),n=$("#jstree_demo_div",a);if(n.length&&n.is(":visible")){e=n.jstree(!0).get_json("#",{flat:!1}),e=JSON.stringify(e),n=n.data();return $.ajax({async:!1,type:"POST",url:"/".concat(n.layoutIdentifier,"/tree/").concat(n.columnId),data:{data:e,csrf_token:n.csrfToken}}).done(function(){alert("Tree has been updated")}),!0}return $(t,a).is(":visible")&&UpdateFilter($(t,a)),!0})},Z=function Z(a){$("#type",a).on("change",function(){var e=$("#manage-fields",a),t=e.data("column-type"),n=$(this).val();e.removeClass("column-type-"+t),e.addClass("column-type-"+n),e.data("column-type",n),"rag"==n||"intgr"==n||"person"==n?$("#checkbox-multivalue",a).hide():$("#checkbox-multivalue",a).show()}).trigger("change")},K=function K(e){$("#notify_on_selection",e).on("change",function(){$(this).prop("checked")?$("#notify-options",e).show():$("#notify-options",e).hide()}).trigger("change")},function(e){M(e),H(e),z(e),W(e),G(e),U(e),V(e),Y(e),X(e),Q(e),Z(e),K(e)}),Ie=(ee=function ee(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},te=function te(e){if("none"==e.css("display"))return e;e=e.parent();return e&&e.length?te(e):undefined},ne=function ne(e){if(e.attr("data-actual-height"))return e.attr("data-actual-height");if(e.height())return e.height();var a=te(e);if(a){a.find(".more-less").each(function(){$(this).addClass("more-less-id-"+ee())});var t=a.clone().attr("id",!1).css({visibility:"hidden",display:"block",position:"absolute"});return $("body").append(t),t.find(".more-less").each(function(){var n=$(this),e=n.attr("class").split(/\s+/);$.each(e,function(e,t){0<=t.indexOf("more-less-id")&&a.find("."+t).attr("data-actual-height",n.height())})}),t.remove(),e.attr("data-actual-height")}},ae=function ae(e){var n=function n(){var o,r=$(this),e=r.data("column"),t=r.html();r.removeClass("transparent"),ne(r)<100||(r.addClass("clipped"),o=$("<div/>",{"class":"expandable popover column-content",html:t}),t="Show "+e+" &rarr;",(t=$("<button/>",{"class":"btn btn-xs btn-primary trigger",html:t,type:"button","aria-expanded":!1,"data-expand-on-hover":!0,"data-label-expanded":"Hide "+e,"data-label-collapsed":t})).on("toggle",function(e,t){var n=$(window).width(),a=o.offset().left,i=r.width(),i=400<i?i:400;"expanded"===t&&(o.css("width",i+"px"),a+i+20<n||(i=n-(a+i+20),o.css("left",a+i+"px")))}),r.empty().append(t).append(o),ke(r),o.find(".more-less").each(n))};$(".more-less",e).each(n)},function(e){ae(e)}),Be=(ie=function ie(e,t){t=$(e,t);t.data("open-on-load")&&t.modal("show")},function(e){ie("#modalregister",e),ie("#modal-reset-password",e)}),Je=(oe=function oe(n){var e=$("#modal_metric",n);e.length&&e.on("show.bs.modal",function(e){var t=$(e.relatedTarget),e=t.data("metric_id");$("#metric_id",n).val(e),e?$("#delete_metric",n).show():$("#delete_metric",n).hide();e=t.data("target_value");$("#target_value",n).val(e);e=t.data("x_axis_value");$("#x_axis_value",n).val(e);t=t.data("y_axis_grouping_value");$("#y_axis_grouping_value",n).val(t)})},function(e){oe(e)}),Me=(re=function re(e){e=$("#mygraphs-table",e);e.length&&e.dataTable({columnDefs:[{targets:0,orderable:!1}],pageLength:50,order:[[1,"asc"]]})},function(e){re(e)}),He=function He(){Pe()},ze=(le=function le(){var e=$("body").data("layout-identifier"),n=e?"/"+e+"/match/user/":"/match/user/";$("#views_other_user_typeahead").typeahead({delay:500,matcher:function(){return!0},sorter:function(e){return e},afterSelect:function(e){$("#views_other_user_id").val(e.id)},source:function(e,t){return $.ajax({type:"GET",url:n,data:{q:e},success:function(e){t(e)},dataType:"json"})}})},function(e){le()}),We=function We(){ze()},Ge=function Ge(){$(".globe").each(function(){Ee($(this))}),ze()},Ue=(ce=function ce(){return{bar:{renderer:$.jqplot.BarRenderer,rendererOptions:{shadow:!1,fillToZero:!0,barMinWidth:10},pointLabels:{show:!1,hideZeros:!0}},donut:{renderer:$.jqplot.DonutRenderer,rendererOptions:{sliceMargin:3,showDataLabels:!0,dataLabels:"value",shadow:!1}},pie:{renderer:$.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"value",shadow:!1}},"default":{pointLabels:{show:!1}}}},se=function se(e,t){var n=e.xlabels,a={},i="line"==t.type;a.highlighter={showMarker:i,tooltipContentEditor:function(e,t,n,a){return a._plotData[t][n][1]}};i=ce();t.type in i?a.seriesDefaults=i[t.type]:a.seriesDefaults=i["default"],"donut"!=t.type&&"pie"!=t.type&&(a.series=e.labels,a.axes={xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:n,label:t.x_axis_name,labelRenderer:$.jqplot.CanvasAxisLabelRenderer},yaxis:{label:t.y_axis_label,labelRenderer:$.jqplot.CanvasAxisLabelRenderer}},e.options.y_max&&(a.axes.yaxis.max=e.options.y_max),e.options.is_metric&&(a.axes.yaxis.tickOptions={formatString:"%d%"}),a.axesDefaults={tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-30,fontSize:"8pt"}}),a.stackSeries=t.stackseries,a.legend={renderer:$.jqplot.EnhancedLegendRenderer,show:t.showlegend,location:"e",placement:"outside"},$.jqplot("chartdiv".concat(t.id),e.points,a)},de=function de(e){var t=null;return $.ajax({async:!1,url:e,dataType:"json",success:function(e){t=e}}),t},ue=function ue(e){ve(),$.jqplot.config.enablePlugins=!0,e.each(function(e,t){var n=$(t).data(),t=(new Date).getTime(),t="/".concat(n.layoutId,"/data_graph/").concat(n.graphId,"/").concat(t),t=de(t),n={type:n.graphType,x_axis_name:n.xAxisName,y_axis_label:n.yAxisLabel,stackseries:n.stackseries,showlegend:n.showlegend,id:n.graphId};se(t,n)})},fe=function fe(e){var t=$("#chartdiv",e),e=$("[id^=chartdiv]",e);!t.length&&e.length&&ue(e)},function(e){$(document).ready(function(){fe(e)})}),Ve=function Ve(e){ze(),Ue(e)},Ye=(pe=function pe(e){$(".table tr[data-href]",e).on("click",function(){window.location=$(this).data("href")})},function(e){pe(e)}),Xe=function Xe(){Ye(),ze(),$("#modal_sendemail").on("show.bs.modal",function(e){e=$(e.relatedTarget).data("peopcol_id");$("#modal_sendemail_peopcol_id").val(e)}),$("#data-table").floatThead({floatContainerCss:{},zIndex:function(){return 999},ariaLabel:function(e,t){return t.data("thlabel")}}),FontDetect.isFontLoaded("14px/1 FontAwesome")||($(".use-icon-font").hide(),$(".use-icon-png").show()),$("#rows_per_page").on("change",function(){this.form.submit()})},Qe=(he=function he(e){var t=e||document;tippy(t.querySelectorAll(".vis-foreground"),{target:".timeline-tippy",theme:"light",onShown:function(){$(".moreinfo",e).off("click").on("click",function(e){var t=$(e.target).data("record-id"),e=$("#readmore_modal");e.find(".modal-body").text("Loading..."),e.find(".modal-body").load("/record_body/"+t),e.modal()})}})},function(e){he(e)});function Ze(t,n){var a=1<arguments.length&&n!==undefined?n:"height";if(!t||!t.length)return 0;try{var i=t.css(a);return i?parseFloat(parseFloat(i.replace("px")).toFixed(4)):0}catch(e){return console.error("fatal error",e),0}}function Ke(e){var t=(e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("-o-transform")||e.css("transform")).replace(/[^0-9\-.,]/g,"").split(","),e=t[12]||t[4],t=t[13]||t[5];return{x:parseFloat(e),y:parseFloat(t)}}function et(e){var n,a,i,t,o,r=Math.floor(e.offset().top),l=Ze(e,"height"),c=(n=[],a={},i=[],e.find(".vis-item:visible").each(function(){var e=Ze($(this),"top"),t=Ke($(this)),e=0===e?t.y:e;-1===$.inArray(e,i)&&i.push(e),a[e]||(a[e]=[]),a[e].push({node:$(this),label:$(this).find(".timeline-tippy").html().trim(),width:Ze($(this),"width"),x:t.x,y:t.y,top:e,textColor:!!$(this).css("color")&&$(this).css("color"),backgroundColor:$(this).css("background-color")})}),i.sort(function(e,t){return t<e?1:-1}),$.each(i,function(e,t){n.push(a[t])}),n);return{node:e,top:r=0===r?Ke(e).y:r,height:l,label:(t=r,r=$(".vis-label:visible"),o=null,r.each(function(){var e=0===(e=$(this).offset().top)?Ke($(this)).y:e;Math.floor(e)===t&&(o=$(this))}),o?{node:o,text:o.find(".vis-inner").first().html()||""}:null),itemRows:c}}function tt(){var t,e,n,a,i,o,r,l,c,s,d,u,f,p,h=(p=$(".vis-foreground .vis-group:visible"),t={},p&&0!==p.length&&p.each(function(){var e;$(this).html()&&(e=et($(this)),t[e.top]=e)}),t);h!=={}&&(e=h,n=$("#html").first(),a=$(".vis-timeline").first(),i=$(".vis-time-axis.vis-foreground").first(),o=$(".vis-panel.vis-left").first(),r=i.find(".vis-text.vis-minor:not(.vis-measure)").first(),l=nt(e)||!1,c=!!l&&nt(l.itemRows),s=!!(c&&c[0]&&c[0].node)&&c[0].node,d=!!s&&s.find(".vis-item-content").first(),u=$(".vis-label:visible").first(),f=$(".vis-current-time"),p=0<Ze(u,"width")?"true":"false",h=Ze(a,"width"),l=$("#fit_to_page_width").prop("checked"),c=parseInt($("#pdf_zoom").val(),10),u=n.data("url-js"),a=n.data("url-css"),n=0<c/100?c/100:1,c=l&&0<1550/h?1550/h:1,h=l?c:n,l=Ze(s,"font-size"),c=Ze(s,"line-height"),n=Ze(i,"height"),o=Ze(o,"width"),s=Ze(s,"border-top-width"),d=Ze(d,"padding-top"),r=Ze(r,"padding-top"),f=f.length?Ke(f.first()).x:-1,e="{"+function(e){return"xAxis: {height: tableXAxisBarHeight,x: "+Ke(e.find(".vis-text.vis-minor:not(.vis-measure)").first()).x+",major: "+function(a){var e=function(e){var e=e.find(".vis-text.vis-major:not(.vis-measure)"),n=[];e.each(function(){n.push({node:$(this),x:Ke($(this)).x,x_end:!1})}),n.sort(function(e,t){return e.x>t.x?1:-1}),n.reverse();var a=!1;return $(n).each(function(e,t){n[e].x_end=a,a=n[e].x}),n.reverse(),n}(a),i="";e&&e.length?$.each(e,function(e,t){var n=t.node.find("div").first().html(),e=at(a,t.x,t.x_end,0===e);i+=(""===i?"":",")+'{text: "'+n+'", x: '+t.x+", minor: "+e+"}"}):i+='{text: "", x: '+majorObject.x+", minor: "+at(a)+"}";return"["+i+"]"}(e)+"}"}(i)+","+function(e){var n="";return $.each(e,function(e,t){var a;n+=(""===n?"":",")+'{label: "'+t.label.text+'", rows: ['+(t=t.itemRows,a="",$.each(t,function(e,t){var n;a+=(""===a?"":",")+"{items: ["+(t=t,n="",$.each(t,function(e,t){n+=(""===n?"":",")+"{x: "+t.x+", width: "+t.width+', text: "'+t.label.trim()+'", top: '+t.top+', textColor: "'+t.textColor+'", backgroundColor: "'+t.backgroundColor+'" }'}),n)+"]}"}),a)+"]}"}),"groups: ["+n+"]"}(e)+"}",$("input#html").val('<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8">\n    <title>Data</title>\n    <script type="application/javascript" src="'.concat(u,'/jquery-3.5.1.min.js"><\/script>\n    <script type="application/javascript" src="').concat(u,'/pdf_printer.js"><\/script>\n    <link rel="stylesheet" type="text/css" href="').concat(a,'/pdf_printer.css">\n    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans">\n  </head>\n  <body>\n    <script type="application/javascript">\n      const pagePrefix = "page_";\n      const pageHeight = 1086;\n      const pageWidth = 1550;\n      const pageScaleFactor = ').concat(h,';\n      const backgroundColor = "#fff";\n      const foregroundColor = "#333";\n      const xAxisMinorColor = "#ccc";\n      const xAxisTextColor = "#4d4d4d";\n      const currentTimeColor = "#ff7f6e";\n      const font = "Open Sans";\n      const fontSize = ').concat(l," * pageScaleFactor;\n      const lineHeight = ").concat(c," * pageScaleFactor;\n      const tableXAxisBarHeight = ").concat(n," * pageScaleFactor;\n      const showYAxisBar = ").concat(p,";\n      const tableYAxisBarWidth = showYAxisBar ? ").concat(o," * pageScaleFactor : 0;\n      const borderSize = ").concat(s," * pageScaleFactor;\n      const padding = ").concat(d," * pageScaleFactor;\n      const xAxisPadding = ").concat(r," * pageScaleFactor;\n      const currentTimeX = ").concat(f," * pageScaleFactor + tableYAxisBarWidth;\n      const currentTimeThickness = 2 * pageScaleFactor;\n      const pageData = ").concat(e,";\n      let pageNumber = 0;\n      let currentHeight = 0;\n      let canvas = null;\n      let context = null;\n\n      drawTimelinePdf();\n    <\/script>\n  </body>\n</html>")))}function nt(e){return function(e,t){return t=1<arguments.length&&t!==undefined?t:0,e[Object.keys(e)[t]]||null}(e,0)}function at(e,t,n,a){var i=1<arguments.length&&t!==undefined&&t,o=2<arguments.length&&n!==undefined&&n,r=!(3<arguments.length&&a!==undefined)||a,e=e.find(".vis-text.vis-minor:not(.vis-measure)"),l="";return!1!==o&&--o,$.each(e,function(){var e=$(this),t=Ke(e);if(!1!==i){if(r&&!1!==o&&t.x>=o)return!0;if(!r&&(t.x<i||!1!==o&&t.x>=o))return!0}var n=Ze(e,"width"),e=e.html();l+=(""===l?"":",")+"{x: "+t.x+", width: "+n+', text: "'+e+'"}'}),"["+l+"]"}var it=function it(e){e.forEach(function(e){var t,n,a,i;!e.style||"string"!=typeof e.style||(a=e.style.match(/background-color:\s(#[0-9A-Fa-f]{6})/))&&a[1]&&(t=a[1],"dark"==(a=(i=+("0x"+(n=t).slice(1).replace(n.length<5&&/./g,"$&$&")))>>16,n=i>>8&255,i&=255,150<Math.sqrt(a*a*.299+n*n*.587+i*i*.114)?"light":"dark")&&(e.style=e.style+";color: #FFFFFF;text-shadow: -1px -1px 0.1em "+t+",1px -1px 0.1em "+t+",-1px 1px 0.1em "+t+",1px 1px 0.1em "+t+",1px 1px 2px "+t+",0 0 1em "+t+",0 0 0.2em "+t+";"))})},ot=function ot(r,e){var t=r.data("records"),n=base64.decode(t),t=JSON.parse(n);it(t);var a,i,l=new vis.DataSet(t),n=r.data("groups"),t=base64.decode(n),n=JSON.parse(t),o=!!r.data("dashboard"),c=$("body").data("layout-identifier"),s={margin:{item:{horizontal:-1}},moment:(a=function(e){return moment(e).utc()},d.toString=function(){return a.toString()},d),clickToUse:o,zoomFriction:10,template:Handlebars.templates.timelineitem,orientation:{axis:"both"}};function d(e){return a.apply(this,arguments)}for(i in e)s[i]=e[i];r.data("min")&&(s.start=r.data("min")),r.data("max")&&(s.end=r.data("max")),r.data("width")&&(s.width=r.data("width")),r.data("height")&&(s.width=r.data("height")),r.data("rewind")||(s.editable={add:!1,updateTime:!0,updateGroup:!1,remove:!1},s.multiselect=!0);var u,f,t=new vis.Timeline(r.get(0),l,s);0<n.length&&t.setGroups(n),t.on("rangechanged",function(e){return e.byUser?(e.start.getTime()>f&&e.end.getTime()<u||(r.prev("#loading-div").show(),o=l.min("start"),t=(o=l.max("start"))?new Date(o.start):undefined,(n=(o=l.min("end"))?new Date(o.end):undefined)&&!o.has_time&&n.setDate(n.getDate()-1),o=l.max("end"),a=(o=l.min("single"))?new Date(o.single):undefined,i=(o=l.max("single"))?new Date(o.single):undefined,(o={}).min=n&&a?n<a?n:a:n||a,o.max=t&&i?i<t?t:i:t||i,o.min||m(e.start.getTime(),e.end.getTime()),e.start<o.min&&m(e.start.getTime(),o.min.getTime(),"to"),e.end>o.max&&m(o.max.getTime(),e.end.getTime(),"from"),(!u||u<e.end.getTime())&&(u=e.end.getTime()),(!f||f>e.start.getTime())&&(f=e.start.getTime()),r.prev("#loading-div").hide()),void h(e)):(f=f||e.start.getTime(),void(u=u||e.end.getTime()));var t,n,a,i,o});var p=$("body").data("csrf-token");function h(e){o||$.post({url:"/"+c+"/data_timeline?",data:"from="+e.start.getTime()+"&to="+e.end.getTime()+"&csrf_token="+p})}function m(e,t,n){n="/"+c+"/data_timeline/10?from="+e+"&to="+t+"&exclusive="+n;o&&(n=n+"&dashboard=1&view="+r.data("view")),$.ajax({async:!1,url:n,dataType:"json",success:function(e){l.add(e)}})}return $("#tl_group").on("change",function(){$(this).find(":selected").data("fixedvals")?$("#tl_all_group_values_div").show():$("#tl_all_group_values_div").hide()}).trigger("change"),t};$(document).ready(function(){var e,t,n=$("#modal_pdf");n.length&&(e=n.find("form").first(),n=$("#fit_to_page_width").first(),t=$("#pdf_zoom").first(),n.change(function(){var e;$(this).is(":checked")?(t.data("original-value",t.val()),t.val(100),t.prop("disabled",!0)):(e=parseInt(t.data("original-value"),10),t.val(0<e?e:100),t.prop("disabled",!1))}),e.submit(function(){return tt(),!0}))});var rt,lt,ct,st,dt,ut,ft,pt,ht,mt,vt,gt,$t,bt,yt,_t,xt,wt,kt,Tt,jt,Ct,Ot,At,St,Dt,Lt,qt,Rt,Et=function Et(){var a="#submit_button",i={},o=function o(e,t){i[e.id]=e;var n=$(a);n.is(":hidden")&&($(window).bind("beforeunload",function(e){var t="If you leave this page your changes will be lost.";return e&&(e.returnValue=t),t}),n.closest("form").css("display","block"));n=$("<li>"+e.content+"</li>");return $("#visualization_changes").append(n),t(e)},r=function r(e){var t=e.getUTCFullYear(),n=("0"+(e.getUTCMonth()+1)).slice(-2),e=("0"+e.getUTCDate()).slice(-2);return timeline.moment.utc(""+t+n+e)},e={onMove:o,snap:r},e=ot($(".visualization"),e),t=function t(){var e=_.mapObject(i,function(e){return{column:e.column,current_id:e.current_id,from:e.start.getTime(),to:(e.end||e.start).getTime()}});$(window).off("beforeunload");e=JSON.stringify(e);$("#changed_data").attr("value",e)};$(a).bind("click",t),$("#cancel_button").bind("click",function(){$(window).off("beforeunload")});var l=$("body").data("layout-identifier"),c=function c(e){var t,n=e.items;0==n.length?$(".bulk_href").on("click",function(e){return e.preventDefault(),alert("Please select some records on the timeline first"),!1}):(t=[],$("#delete_ids").empty(),e.items.forEach(function(e){e=e.replace(/\+.*/,"");t.push("id="+e),$("#delete_ids").append('<input type="hidden" name="delete_id" value="'+e+'">')}),e=t.join("&"),$("#update_href").attr("href","/"+l+"/bulk/update/?"+e),$("#clone_href").attr("href","/"+l+"/bulk/clone/?"+e),$("#count_delete").text(n.length),$(".bulk_href").off())};e.on("select",c),c({items:[]}),Qe(),ze()},Pt=function Pt(){ze(),$("#views_other_user_typeahead").on("change",function(){$(this).val()||$("#views_other_user_id").val("")})},Ft=(rt=function rt(){var e=$(this),t=e.data("column-id"),n=e.data("is-multivalue"),a=e.find(".tree-widget-container"),i=a.data("field"),o=$("body").data("layout-identifier"),r=a.data("end-node-only"),l=a.data("ids-as-params"),e={core:{check_callback:!0,force_text:!0,themes:{stripes:!0},worker:!1,data:{url:function(){return"/"+o+"/tree"+(new Date).getTime()+"/"+t+"?"+l},data:function(e){return{id:e.id}}}},plugins:[]};n?e.plugins.push("checkbox"):e.core.multiple=!1,a.on("changed.jstree",function(e,n){a.nextAll(".selected-tree-value").remove();var t=a.jstree("get_selected",!0);$.each(t,function(){var e=$('<input type="hidden" class="selected-tree-value" name="'+i+'" value="'+this.id+'" />').insertAfter(a),t=n.instance.get_path(this,"#");e.data("text-value",t)}),0==t.length&&a.after('<input type="hidden" class="selected-tree-value" name="'+i+'" value="" />'),a.trigger("change")}),a.on("select_node.jstree",function(e,t){0!=t.node.children.length&&(r?(a.jstree(!0).deselect_node(t.node),a.jstree(!0).toggle_node(t.node)):n&&a.jstree(!0).open_node(t.node))}),a.jstree(e),Fe(a),a.jstree(!0).settings.checkbox.cascade="undetermined"},lt=function lt(e){$('[data-column-type="tree"]',e).filter(function(){return $(this).find(".tree-widget-container").length}).each(rt)},function(e){lt(e)}),Nt=(ct=function ct(){var i=this.condition,o=this.rules,r=this.field;r.data("dependent-not-shown")&&r.hide();var l=function l(o,e){if(0==e.length)return!0;var r=!1;return e.some(function(e){var t=e.dependsOn,n=e.regexp,a=e.is_negative,e=Ce(t,e.filtered),i=!a;return $.each(e,function(e,t){t===undefined&&(t=""),a?n.test(t)&&(i=1):n.test(t)&&(i=0)}),i||(r=!0),!!o&&("OR"==o?r:(i&&(r=!1),!r))}),r};o.forEach(function(e){var n=e.dependsOn,a=function a(){l(i,o)?r.show():r.hide();var t=r.closest(".panel-group");t.length&&t.find(".linkspace-field").each(function(){var e=!0;if("none"!=$(this).css("display"))return t.show(),e=!1;e&&t.hide()}),r.data("column-id")!=n.data("column-id")&&r.trigger("change")};0==n.length&&a(),n.on("change",function(){a()})})},st=function st(o){$("[data-has-dependency]",o).map(function(){var e=$(this).data("dependency"),t=JSON.parse(base64.decode(e)),e=t.rules,t=t.condition,e=jQuery.map(e,function(e){var t=e.operator,n=-1!==t.indexOf("not"),a=-1!==t.indexOf("equal")?new RegExp("^"+e.value+"$","i"):new RegExp(e.value,"i"),i=e.id,t=!1;return e.filtered&&(i=e.filtered,t=!0),{dependsOn:$('[data-column-id="'+i+'"]',o),regexp:a,is_negative:n,filtered:t}});return{field:$(this),condition:t,rules:e}}).each(ct),$(".panel-group").each(function(){var e=$(this);e.find(".table-fields").find("tr").filter(function(){return"none"!=$(this).css("display")}).length||e.find(".linkspace-field").filter(function(){return"none"!=$(this).css("display")}).length||e.hide()})},function(e){st(e)}),It=(dt=function dt(){var a=this.code,e=this.depends_on,i=this.field,o=this.params;a="return "+(a=a.replace(/^function\s+evaluate\s+/gi,"function ")),e.forEach(function(e){e.on("change",function(){var e=o.map(function(e){e=$('.linkspace-field[data-name-short="'+e+'"]');return Ce(e,!1,!0)}),t=fengari.load(a)(),n=e.shift(),e=t.apply(n,e);i.find("input").val(e),i.closest(".linkspace-field").trigger("change")})})},ut=function ut(t){$("[data-calc-depends-on]",t).map(function(){var e=$(this).data("calc-depends-on"),e=JSON.parse(base64.decode(e)),e=jQuery.map(e,function(e){return $('[data-column-id="'+e+'"]',t)});return{field:$(this),code:base64.decode($(this).data("code")),params:JSON.parse(base64.decode($(this).data("code-params"))),depends_on:e}}).each(dt)},function(e){ut(e)}),Bt=(ft=function ft(e){var t="Please note that any changes will be lost.";return(e=e||window.event)&&(e.returnValue=t),t},pt=function pt(e){$(".click-to-edit",e).on("click",function(){var e=$(this);this.innerHTML="Edit"===this.innerHTML?"View":"Edit",$(e.data("viewEl")).toggleClass("expanded"),$(e.data("editEl")).toggleClass("expanded"),"View"===this.innerHTML?window.onbeforeunload=ft:window.onbeforeunload=null}),$(".submit_button").click(function(){window.onbeforeunload=null}),$(".remove-unload-handler").click(function(){window.onbeforeunload=null})},function(e){pt(e)}),Jt=(ht=function ht(e){$(".table--zebra",e).each(function(e,t){var n=!0;$(t).children("tbody").children("tr:visible").each(function(e,t){$(t).toggleClass("odd",n),$(t).toggleClass("even",!n),n=!n})})},function(e){ht(e)}),Mt=(mt=function mt(t){$(".click-to-view-blank",t).on("click",function(){var e="Show blank values"===this.innerHTML;$(".click-to-view-blank-field",t).toggle(e),this.innerHTML=e?"Hide blank values":"Show blank values",Jt(t)})},function(e){mt(e)}),Ht=function Ht(e){var u=".intcalculator";$(".fileupload",e);$(u,e).closest(".form-group").find("label").each(function(){var i,o,e=$(this),r=$('<div class="dropdown-menu" id="calculator_div"></div>');r.css({position:"absolute","z-index":1100,display:"none",padding:"10px"}),$("body").append(r),r.append('<form class="form-inline">    <div class="form-group btn-group operator" data-toggle="buttons"></div>    <div class="form-group"><input type="text" placeholder="Number" class="form-control"></input></div>    <div class="form-group">        <input type="submit" value="Calculate" class="btn btn-default"></input>    </div></form>'),$(document).mouseup(function(e){r.is(e.target)||0!==r.has(e.target).length||r.hide()});var l,c=[{action:"add",subvaluelabel:"+",keypress:["+"],operation:function(e,t){return e+t}},{action:"subtract",label:"-",keypress:["-"],operation:function(e,t){return e-t}},{action:"multiply",label:"×",keypress:["*","X","x","×"],operation:function(e,t){return e*t}},{action:"divide",label:"÷",keypress:["/","÷"],operation:function(e,t){return e/t}}],s={},d=r.find(".operator");for(l in c)!function(){var e,t=c[l],n=$('<label class="btn btn-primary" style="width:40px"><input type="radio" name="op" class="btn_label_'+t.action+'">'+t.label+"</input></label>");for(e in d.append(n),n.on("click",function(){i=t.operation,r.find(":text").focus()}),t.keypress){var a=t.keypress[e];s[a]=t.action}}();r.find(":text").on("keypress",function(e){var t=e.key;t in s&&(t=".btn_label_"+s[t],r.find(t).click(),e.preventDefault())}),r.find("form").on("submit",function(e){var t=i(+o.val(),+r.find(":text").val());o.val(t),r.hide(),e.preventDefault()}),$('<span class="btn-xs btn-link openintcalculator">Calculator</span>').insertAfter(e).on("click",function(e){var t=$(e.target).closest(".form-group"),n=t.find(u),a=t.offset().top,i=t.height(),e=$("#calculator_div").height(),i=e<a?a-e:a+i;r.css({top:i,left:t.offset().left});t=r.find(":text");t.val(""),r.show(),t.focus(),o=n})})},zt=function zt(e){Linkspace.debug("Record edit JS firing"),Ft(e),Nt(e),It(e),Bt(e),Mt(e),Ht(e),Jt(e)},Wt=function Wt(){$("#is_shared").change(function(){$("#group_id_div").toggle(this.checked)}).change(),$(".date-grouping").change(function(){$("#trend").val()||$("#set_x_axis").find(":selected").data("is-date")?$("#x_axis_date_display").show():$("#x_axis_date_display").hide()}).change(),$("#trend").change(function(){$(this).val()?$("#group_by_div").hide():$("#group_by_div").show()}).change(),$("#x_axis_range").change(function(){"custom"==$(this).val()?$("#custom_range").show():$("#custom_range").hide()}).change(),$("#y_axis_stack").change(function(){"sum"==$(this).val()?$("#y_axis_div").show():$("#y_axis_div").hide()}).change()},Gt=(vt=function vt(e){$(".dtable",e).each(function(){var i,t,n={order:[[1,"asc"]],pageLength:$(this).data("page-length")||10};"users"==$(this).data("type")?(i=function i(e,t,n,a){return"filter"!=t&&"sort"!=t&&"type"!=t&&"display"==t?$("<div />").text(e).html():e},n.ajax="/api/users",n.serverSide=!0,n.processing=!0,t=$(this),$.ajax("/api/users?cols=1",{success:function(e){(e=e.map(function(e){return e.render=i,e})).unshift({name:"id",data:"id",render:function(e,t,n,a){return"display"==t?'<a href="/user/'+e+'">'+e+"</a>":e}}),n.columns=e,t.dataTable(n)}})):$(this).dataTable(n)})},function(e){vt(e)}),Ut=function Ut(e){Gt(e),$("#submit").on("click",function(){$(".dtable").DataTable().column(0).nodes().to$().each(function(){var e=$(this).find("input");e.is(":checked")&&$('<input type="hidden" name="graphs">').val(e.val()).appendTo("form")})})},Vt=function Vt(e,t){var n=e.xlabels,a={},i="line"==t.type;a.highlighter={showMarker:i,tooltipContentEditor:function(e,t,n,a){return a._plotData[t][n][1]}},"bar"==t.type?a.seriesDefaults={renderer:$.jqplot.BarRenderer,rendererOptions:{shadow:!1,fillToZero:!0,barMinWidth:10},pointLabels:{show:!1,hideZeros:!0}}:"donut"==t.type?a.seriesDefaults={renderer:$.jqplot.DonutRenderer,rendererOptions:{sliceMargin:3,showDataLabels:!0,dataLabels:"value",shadow:!1}}:"pie"==t.type?a.seriesDefaults={renderer:$.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0,dataLabels:"value",shadow:!1}}:a.seriesDefaults={pointLabels:{show:!1}},"donut"!=t.type&&"pie"!=t.type&&(a.series=e.labels,a.axes={xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:n,label:t.x_axis_name,labelRenderer:$.jqplot.CanvasAxisLabelRenderer},yaxis:{label:t.y_axis_label,labelRenderer:$.jqplot.CanvasAxisLabelRenderer}},e.options.y_max&&(a.axes.yaxis.max=e.options.y_max),e.options.is_metric&&(a.axes.yaxis.tickOptions={formatString:"%d%"}),a.axesDefaults={tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{angle:-30,fontSize:"8pt"}}),a.stackSeries=t.stackseries,a.legend={renderer:$.jqplot.EnhancedLegendRenderer,show:t.showlegend,location:"e",placement:"outside"},$.jqplot("chartdiv"+t.id,e.points,a)},Yt=window.do_plot_json=function(e,t){e=JSON.parse(base64.decode(e)),t=JSON.parse(base64.decode(t)),Vt(e,t)},Xt=function Xt(e){$(document).ready(function(){$(".dashboard-graph",e).each(function(){var e=$(this),t=e.data("plot-data"),e=e.data("plot-options");Yt(t,e)}),$(".visualization",e).each(function(){ot($(this),{})}),$(".globe",e).each(function(){Ee($(this))}),Qe(e)})},Qt=function Qt(){var e=$(this),i=e.find('[role="tab"]'),o=e.find('[role="tabpanel"]'),r=[];i.each(function(e){r[e]=$(this),$(this).data("index",e)});var l=function l(e){e&&e.preventDefault();var t=$(this);if("true"===t.attr("aria-selected"))return!1;var n=o.filter(t.attr("href")),a=i.filter('[aria-selected="true"]'),e=o.filter(".active");return a.attr("aria-selected",!1),e.removeClass("active"),t.attr("aria-selected",!0),n.addClass("active"),t.attr("tabindex","0"),i.filter('[aria-selected="false"]').attr("tabindex","-1"),!1},c=function c(e){var t,n=$(this).data("index"),a=e.keyCode,i=Linkspace.constants.ARROW_LEFT,e=Linkspace.constants.ARROW_RIGHT;[i,e].indexOf(a)<0||(a===i&&(t=r[n-1])||a===e&&(t=r[n+1]))&&(l.call(t),t.focus())};i.on("click",l),i.on("keyup",c),i.filter('[aria-selected="false"]').attr("tabindex","-1")},Zt=function Zt(e){$(".tab-interface").each(Qt);var i=$("#permission-configuration"),t=$(".permission-rule",e),o=$("#permission-rule-template"),e=t.find("button.cancel-permission"),t=t.find("button.add-permission"),r=function r(){i.find("input").each(function(){$(this).prop("checked",!1)}),i.attr("hidden",""),$("#configure-permissions").removeAttr("hidden").focus()},l=function l(){var n=$(this),e=n.data("group-id"),t=n.find("button.edit"),a=n.find("button.delete"),i=n.find("button.ok");n.find("input").on("change",function(){var e="permission-"+$(this).data("permission-class"),t=$(this).prop("checked");n.toggleClass(e,t),t||$(this).siblings("div").find("input").each(function(){$(this).prop(t),e="permission-"+$(this).data("permission-class"),n.toggleClass(e,t)})}),t.on("expand",function(){n.addClass("edit"),n.find(".group-name").focus()}),a.on("click",function(){$("#permissions").removeClass("permission-group-"+e),n.remove()}),i.on("click",function(){n.removeClass("edit"),i.parent().removeClass("expanded"),t.attr("aria-expanded",!1).focus()})};e.on("click",r),t.on("click",function(){var n=$(o.html()),e=$("#current-permissions ul"),t=i.find("option:selected"),a=t.val();i.find("input").each(function(){var e=$(this),t=e.prop("checked");t&&n.addClass("permission-"+e.data("permission-class").replace(/_/g,"-")),n.find("input#"+e.attr("id")).prop("checked",t).attr("id",e.attr("id")+a).attr("name",e.attr("name")+a).next("label").attr("for",e.attr("id"))}),n.appendTo(e),n.attr("data-group-id",a),$("#permissions").addClass("permission-group-"+a),n.find(".group-name").text(t.text()),n.find("button.edit").on("click",_e),l.call(n),r()}),$("#configure-permissions").on("click",function(){var t=$("#permissions"),n=!1;$("#permission-configuration").find("option").each(function(){var e=$(this);e.removeAttr("disabled"),t.hasClass("permission-group-"+e.val())?e.attr("disabled",""):n||(e.attr("selected",""),n=!0)}),$(this).attr("hidden",""),$("#permission-configuration").removeAttr("hidden"),$(this).parent().find("h4").focus()}),$("#current-permissions .permission").each(l)},Kt=function Kt(){$(".remember-me").each(function(){var t=$(this).find("input:checkbox");t.on("change",function(){var e=t.is(":checked");t.toggleClass("remember--checked",e)})}),$(".show-password").each(function(){var t=$(this).find("input:checkbox"),n=document.querySelector("input[name=password]");t.on("change",function(){var e=t.is(":checked");t.toggleClass("show_password--checked",e),n.type=e?"text":"password"})})},en=function en(){$("#modal_metric").on("show.bs.modal",function(e){var t=$(e.relatedTarget),e=t.data("metric_id");$("#metric_id").val(e),e?$("#delete_metric").show():$("#delete_metric").hide();e=t.data("target_value");$("#target_value").val(e);e=t.data("x_axis_value");$("#x_axis_value").val(e);t=t.data("y_axis_grouping_value");$("#y_axis_grouping_value").val(t)})},tn=function tn(){$("#selectall").click(function(){$(".record_selected").prop("checked",this.checked)})},nn=function nn(){Pe()},an=function an(e){Gt(e),$(document).on("click",".cloneme-user",function(){var e=$(this).parents(".limit-to-view");e.clone().removeAttr("id").insertAfter(e)}),$(document).on("click",".removeme-user",function(){var e=$(this).parents(".limit-to-view");0<e.siblings(".limit-to-view").length&&e.remove()})},on=(gt={config:He,data_calendar:We,data_globe:Ge,data_graph:Ve,data_table:Xe,data_timeline:Et,audit:Pt,edit:zt,graph:Wt,graphs:Ut,index:Xt,layout:Zt,login:Kt,metric:en,purge:tn,system:nn,user:an},$t=function $t(e){var t=$("body").data("page").match(/^(.*?)(:?\/\d+)?$/);null===t||(t=gt[t[1]])!==undefined&&t(e)},function(e){$t(e)}),rn=(bt=function bt(e){$("input, text",e).placeholder()},function(e){bt(e)}),ln=(yt=function yt(e){$('[data-toggle="popover"]',e).popover({placement:"auto",html:!0})},function(e){yt(e)}),cn=(_t=function _t(e){$("#selectall",e).click(function(){$(".record_selected",e).prop("checked",this.checked)})},function(e){_t(e)}),sn=(xt=function xt(e){$(".record-popup",e).on("click",function(){var e=$(this).data("record-id"),t=$(this).data("version-id"),n=$("#readmore_modal"),a=n.find(".modal-body");a.text("Loading...");e="/record_body/"+e;t&&(e=e+"?version_id="+t),a.load(e,null,function(){Jt(a)}),n.modal(),event.stopPropagation()})},function(e){xt(e)}),dn=(wt=function wt(e){$(".edit-form",e).on("submit",function(){var e=$(document.activeElement);e.prop("disabled",!0),e.prop("name")&&e.after('<input type="hidden" name="'+e.prop("name")+'" value="'+e.val()+'" />')})},function(e){wt(e)}),un=(kt=function kt(e){$("#modal_sendemail",e).on("show.bs.modal",function(e){e=$(e.relatedTarget).data("peopcol_id");$("#modal_sendemail_peopcol_id").val(e)})},Tt=function Tt(n){$("#modal_helptext",n).on("show.bs.modal",function(e){var t=$(e.relatedTarget),e=t.data("col_name");$("#modal_helptext",n).find(".modal-title").text(e);t=t.data("col_id");$.get("/helptext/"+t,function(e){$("#modal_helptext",n).find(".modal-body").html(e)})})},jt=function jt(e){$("#data-table",e).length&&$("#data-table",e).floatThead({floatContainerCss:{},zIndex:function(){return 999},ariaLabel:function(e,t){return t.data("thlabel")}})},function(e){kt(e),Tt(e),jt(e),ve()}),fn=(Ct=function Ct(e){$("#modalnewtitle",e).on("hidden.bs.modal",function(){$("#newtitle",e).val("")}),$("#modalneworganisation",e).on("hidden.bs.modal",function(){$("#neworganisation",e).val("")})},Ot=function Ot(e){$(document,e).on("click",".cloneme",function(){var e=$(this).parents(".limit-to-view");e.clone().removeAttr("id").insertAfter(e)}),$(document,e).on("click",".removeme",function(){var e=$(this).parents(".limit-to-view");0<e.siblings(".limit-to-view").length&&e.remove()})},function(e){Ct(e),Ot(e)}),pn=(At=function At(t){$(".col_check",t).length&&$("#selectall",t).click(function(e){$(".col_check",t).prop("checked",e.currentTarget.checked)})},St=function St(t){$("#global",t).change(function(e){$("#group_id_div",t).toggle(e.currentTarget.checked)}).change()},Dt=function Dt(e){var t=$("div#sorts",e);t.length&&(t.on("click",".closeme",function(e){$(".request-row").length<1||$(e.currentTarget).parents(".request-row").remove()}),t.on("click",".add",function(e){$(e.currentTarget).parents(".sort-add").before(t.data("sortrow"))}))},Lt=function Lt(e){var t=$("div#groups",e);t.length&&(t.on("click",".closeme",function(e){$(".request-row").length&&$(e.currentTarget).parents(".request-row").remove()}),t.on("click",".add",function(e){$(e.currentTarget).parents(".group-add").before(t.data("grouprow"))}))},qt=function qt(e){var t=$("#builder",e);t.length&&t.data("use-json")&&(e=base64.decode(t.data("base-filter")),t.queryBuilder("setRules",JSON.parse(e)))},Rt=function Rt(t){$("#saveview",t).click(function(){var e=$("#builder",t).queryBuilder("getRules");$("#filter",t).val(JSON.stringify(e,null,2))})},function(e){At(e),St(e),Dt(e),Lt(e),qt(e),Rt(e)});window.Linkspace={constants:{ARROW_LEFT:37,ARROW_RIGHT:39},init:function(e){n(e),me(e),ge(e),$e(e),ke(e),De(e),Le(e),qe(e),Re(e),Pe(e),Ne(e),Ie(e),Be(e),Je(e),Me(e),on(e),rn(e),ln(e),cn(e),sn(e),Te(e),dn(e),un(e),fn(e),pn(e)},debug:function(e){"undefined"!=typeof console&&console.debug&&console.debug("[LINKSPACE]",e)},error:function(e){"undefined"!=typeof console&&console.error&&console.error("[LINKSPACE]",e)}},window.Linkspace.init()}();
